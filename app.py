import streamlit as st
import sqlite3

conn = sqlite3.connect('data/exploitable_db.sqlite')
c = conn.cursor()

def connect(username, password):
    query = f"""
    SELECT *
    FROM users
    WHERE users.username = '{username}'
    AND users.password = '{password}'
    """
    #   print(query)
    c.execute(query)
    user = c.fetchone()
    if user is None:
        return ("Unauthorized", "red", query)
    else:
        return ("Authorized", "green", query)

st.set_page_config(page_title="Fakebook", page_icon="ðŸ˜Ž", layout='centered')

# inject CSS
m = st.markdown("""
<style>
p {text-align: center; color: grey;}
* {text-align: center;}
.block-container {padding: 16px 0px 0px 0px!important}
img {margin-top: 0px;}
</style>""",unsafe_allow_html=True)


st.columns(3)[1].image("logo.png")
st.markdown(f"<a href='https://github.com/yannklein/exploitable-website/blob/master/app.py'>Github repo</a>", unsafe_allow_html=True)
current = ("","","")

with st.columns(3)[1].form("my_form"):
    login_val = st.text_input("Login", placeholder="john")
    password_val = st.text_input("Password", placeholder="passw0rd", help="Try ' OR TRUE-- to hack the login")

    # Every form must have a submit button.
    submitted = st.form_submit_button("Submit")
    if submitted:
        current = connect(login_val, password_val)

st.markdown(f"<h1 style='color: {current[1]};'>{current[0]}</h1>", unsafe_allow_html=True)
st.markdown(f"<p>{current[2]}</p>", unsafe_allow_html=True)
